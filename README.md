# iphizic_infra
iphizic Infra repository

# How To

## SSH
 + Чтобы приконнектится к хосту через бастион одной коммандой необходимо использовать 
 комманду следующего вида:
 
    ```bash
    ssh -A bastion ssh iphizic@10.166.0.2 
    ```
      
     Во первых мы можем увидеть алиас бастиона, который может быть записан 
     В конфигурационный файл ~/.ssh/config добавлением следующего кода:
     
     ```bash
     Host bastion                     # Здесь описывается алиас по которому можно обращаться
          HostName 35.207.87.ХХХ      # Здесь описывается ip адрес хоста или его DNS имя
          User iphizic                # Здесь описывается логин для аутентификации
          IdentityFile ~/.ssh/id_rsa  # Здесь описывается путь к файлу закрытого ключа
     ```
     
     Однако при попытке подключения мы увидим ошибку:
     
     ```bash
     $ ssh -A bastion ssh iphizic@10.166.0.2
     Pseudo-terminal will not be allocated because stdin is not a terminal.
     ```
     Это связано с тем что консоль пытается открыть две интерактивные сессии сразу и 
     они тут-же падают, поэтому используем параметр который логинится без открытия 
     интерактивной консоли, и комманда будет выглядить так:
     ```bash
     ssh -A -t bastion ssh iphizic@10.166.0.2 
     ```
 + Второй способ более предпочтителен, но не всегда может быть использован
 это добавление позволяет экономить время, как вы уже догадались, это
 применение конфигурационного файла:
   ```bash
   Host somehost
     HostName 10.166.0.2
     User iphizic
     ProxyCommand ssh -W %h:%p iphizic@35.207.87.209
   ```
   Здесь используется перенаправление stdin и stdout которое позволяет
   использовать данный способ даже на недоверенных бастионах. Но в случаях 
   часто изменяющегося ip не очень удобно.
   
#For bot
   ```bash
   bastion_IP = 35.207.87.209
   someinternalhost_IP = 10.166.0.2   
   ```   
